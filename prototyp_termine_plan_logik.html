<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>Termine – Plan-Logik (Live-Prototyp)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { margin: 0; padding: 0; min-height: 100%; font-family: "Roboto", sans-serif; background: #1c1c1e; color: #1a1a1a; }
    .container { max-width: 480px; margin: 0 auto; padding: 24px 16px 48px; }
    .card { background: #fff; border-radius: 20px; box-shadow: 0 4px 24px rgba(0,0,0,0.12); overflow: hidden; margin-bottom: 24px; }
    h1 { margin: 0; padding: 20px 20px 8px; font-size: 22px; font-weight: 600; border-bottom: 1px solid #eee; }
    .subtitle { padding: 0 20px 16px; font-size: 14px; color: #666; }
    .section-label { font-size: 12px; font-weight: 600; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin: 20px 0 10px; padding: 0 20px; }
    .section-label:first-of-type { margin-top: 0; }
    .chips { display: flex; flex-wrap: wrap; gap: 10px; padding: 0 20px 8px; }
    .chip { min-height: 48px; min-width: 56px; padding: 0 18px; border-radius: 24px; border: 2px solid #1976d2; background: #fff; color: #1976d2; font-size: 15px; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: all 0.15s; }
    .chip.selected { background: #1976d2; color: #fff; border-color: #1976d2; }
    .chip:hover { background: #e3f2fd; }
    .chip.selected:hover { background: #1565c0; color: #fff; }
    .same-day-block { background: #f5f5f5; border-radius: 16px; padding: 16px; margin: 12px 20px; border: 2px solid #e0e0e0; }
    .same-day-block .heading { font-size: 14px; font-weight: 600; color: #424242; margin-bottom: 12px; }
    .radio-item { display: flex; align-items: center; min-height: 52px; padding: 12px 16px; border-radius: 12px; margin-bottom: 8px; cursor: pointer; border: 2px solid #e0e0e0; background: #fff; transition: all 0.15s; }
    .radio-item:last-child { margin-bottom: 0; }
    .radio-item:hover { background: #fafafa; }
    .radio-item.selected { border-color: #1976d2; background: #e3f2fd; }
    .radio-item input { margin-right: 14px; width: 20px; height: 20px; accent-color: #1976d2; flex-shrink: 0; }
    .radio-item span { font-size: 15px; color: #1a1a1a; }
    .radio-item .sublabel { font-size: 12px; color: #666; margin-top: 2px; display: block; }
    .next-card { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 16px; padding: 16px; margin: 20px; border: 1px solid #90caf9; }
    .next-card .label { font-size: 12px; color: #1565c0; font-weight: 600; margin-bottom: 4px; }
    .next-card .value { font-size: 18px; font-weight: 600; color: #0d47a1; }
    .preview-box { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 16px; padding: 20px; margin: 20px; border: 1px solid #a5d6a7; }
    .preview-box .title { font-size: 12px; font-weight: 600; color: #2e7d32; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
    .preview-box .sequence { font-size: 15px; line-height: 1.7; color: #1b5e20; font-weight: 500; }
    .preview-box .sequence .tag { display: inline-block; padding: 2px 8px; border-radius: 6px; margin-right: 4px; font-size: 12px; font-weight: 600; }
    .preview-box .sequence .tag.a { background: #bbdefb; color: #1565c0; }
    .preview-box .sequence .tag.l { background: #c8e6c9; color: #2e7d32; }
    .preview-box .sequence .tag.al { background: #ffe0b2; color: #e65100; }
    .preview-box .meta { font-size: 13px; color: #388e3c; margin-top: 12px; padding-top: 12px; border-top: 1px solid #a5d6a7; }
    .hint { font-size: 13px; color: #666; padding: 12px 20px; background: #fafafa; margin: 8px 0; border-radius: 10px; line-height: 1.5; }
    .btn-save { width: calc(100% - 40px); margin: 24px 20px 32px; min-height: 52px; border: none; border-radius: 26px; background: #1976d2; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.15s; }
    .btn-save:hover { background: #1565c0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Termine – Plan-Logik (Live)</h1>
      <p class="subtitle">Mehrere A/L-Tage, Same-Day-Strategie, Zuordnung 1:1. Nach Plan 2026-02-10.</p>

      <div class="next-card">
        <div class="label">Nächster Termin</div>
        <div class="value" id="next-termin">Wähle A- und L-Tage.</div>
      </div>

      <div class="section-label">A an welchen Wochentagen? (mehrere möglich)</div>
      <div class="chips" id="chips-a">
        <button type="button" class="chip" data-w="0">Mo</button>
        <button type="button" class="chip" data-w="1">Di</button>
        <button type="button" class="chip" data-w="2">Mi</button>
        <button type="button" class="chip" data-w="3">Do</button>
        <button type="button" class="chip" data-w="4">Fr</button>
        <button type="button" class="chip" data-w="5">Sa</button>
        <button type="button" class="chip" data-w="6">So</button>
      </div>

      <div class="section-label">L an welchen Wochentagen? (mehrere möglich)</div>
      <div class="chips" id="chips-l">
        <button type="button" class="chip" data-w="0">Mo</button>
        <button type="button" class="chip" data-w="1">Di</button>
        <button type="button" class="chip" data-w="2">Mi</button>
        <button type="button" class="chip" data-w="3">Do</button>
        <button type="button" class="chip" data-w="4">Fr</button>
        <button type="button" class="chip" data-w="5">Sa</button>
        <button type="button" class="chip" data-w="6">So</button>
      </div>

      <div id="block-same-day" style="display:none;">
        <div class="same-day-block">
          <div class="heading">A und L gleicher Wochentag – wann ist L? (sameDayLStrategy)</div>
          <label class="radio-item selected" id="radio-same">
            <input type="radio" name="same" value="0" checked>
            <span><strong>L am selben Tag wie A</strong><span class="sublabel">sameDayLStrategy = 0 (L = A + 0)</span></span>
          </label>
          <label class="radio-item" id="radio-week">
            <input type="radio" name="same" value="7">
            <span><strong>L eine Woche später</strong><span class="sublabel">sameDayLStrategy = 7 (L = A + 7)</span></span>
          </label>
        </div>
      </div>

      <div id="block-tage-azu-l" style="display:none;" class="hint">
        Zuordnung 1:1: 1. A → 1. L, 2. A → 2. L. tageAzuL pro Paar aus Wochentags-Differenz.
      </div>

      <div class="section-label">Wie oft? (Intervall)</div>
      <div class="chips" id="chips-intervall">
        <button type="button" class="chip selected" data-days="7">Jede Woche</button>
        <button type="button" class="chip" data-days="14">Alle 2 Wo</button>
        <button type="button" class="chip" data-days="21">Alle 3 Wo</button>
        <button type="button" class="chip" data-days="28">Alle 4 Wo</button>
        <button type="button" class="chip" data-days="35">Alle 5 Wo</button>
        <button type="button" class="chip" data-days="42">Alle 6 Wo</button>
        <button type="button" class="chip" data-days="56">Alle 8 Wo</button>
      </div>

      <div class="preview-box">
        <div class="title">Vorschau (Plan Phase 4)</div>
        <div class="sequence" id="preview-sequence">Wähle mindestens einen A- und einen L-Tag.</div>
        <div class="meta" id="preview-meta"></div>
      </div>

      <button type="button" class="btn-save" id="btn-save">Speichern (Demo)</button>
    </div>
  </div>

  <script>
(function() {
  var WOCHE = ['Mo','Di','Mi','Do','Fr','Sa','So'];
  var chipsA = document.getElementById('chips-a');
  var chipsL = document.getElementById('chips-l');
  var blockSame = document.getElementById('block-same-day');
  var blockTageAzuL = document.getElementById('block-tage-azu-l');
  var nextTermin = document.getElementById('next-termin');
  var previewSequence = document.getElementById('preview-sequence');
  var previewMeta = document.getElementById('preview-meta');
  var chipsIntervall = document.getElementById('chips-intervall');
  var radioSame = document.getElementById('radio-same');
  var radioWeek = document.getElementById('radio-week');
  var btnSave = document.getElementById('btn-save');

  var state = { aDays: [], lDays: [], sameDay: '0', intervallDays: 7 };

  function getSelected(container) {
    var out = [];
    container.querySelectorAll('.chip.selected').forEach(function(c) {
      out.push(parseInt(c.getAttribute('data-w'), 10));
    });
    return out.sort(function(a,b) { return a - b; });
  }

  function setsEqual(a, b) {
    if (a.length !== b.length) return false;
    for (var i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;
    return true;
  }

  function tageAzuL(aTag, lTag) {
    if (aTag === lTag) return state.sameDay === '7' ? 7 : 0;
    var d = (lTag - aTag + 7) % 7;
    return d === 0 ? 7 : d;
  }

  function getStartOfDay(ms) {
    var d = new Date(ms);
    d.setHours(0,0,0,0);
    return d.getTime();
  }

  function getWeekday(ms) {
    var d = new Date(ms);
    return (d.getDay() + 6) % 7;
  }

  function nextWeekdayFrom(startMs, targetWeekday) {
    var start = getStartOfDay(startMs);
    var w = getWeekday(start);
    var diff = (targetWeekday - w + 7) % 7;
    if (diff === 0) diff = 7;
    return start + diff * 24 * 60 * 60 * 1000;
  }

  function formatShort(dateMs) {
    var d = new Date(dateMs);
    var day = d.getDate();
    var month = d.getMonth() + 1;
    return WOCHE[getWeekday(dateMs)] + ' ' + (day < 10 ? '0' : '') + day + '.' + (month < 10 ? '0' : '') + month + '.';
  }

  function computeNextTermin() {
    state.aDays = getSelected(chipsA);
    state.lDays = getSelected(chipsL);
    if (state.aDays.length === 0 || state.lDays.length === 0) return null;

    var today = getStartOfDay(Date.now());
    var sameSet = setsEqual(state.aDays, state.lDays);
    var parts = [];

    if (sameSet && state.sameDay === '0') {
      var firstA = nextWeekdayFrom(today, state.aDays[0]);
      state.aDays.forEach(function(w) {
        var aDate = nextWeekdayFrom(today, w);
        if (aDate < firstA) firstA = aDate;
      });
      var seq = state.aDays.map(function(w) { return WOCHE[w] + ' ' + formatShort(nextWeekdayFrom(today, w)) + ' A+L'; }).join(' · ');
      return { text: seq, meta: 'Same-Day (L=A+0)' };
    } else if (sameSet && state.sameDay === '7') {
      var firstA = nextWeekdayFrom(today, state.aDays[0]);
      state.aDays.forEach(function(w) {
        var aDate = nextWeekdayFrom(today, w);
        if (aDate < firstA) firstA = aDate;
      });
      var firstL = firstA + 7 * 24 * 60 * 60 * 1000;
      var seq = state.aDays.map(function(w) {
        var aD = nextWeekdayFrom(today, w);
        var lD = aD + 7 * 24 * 60 * 60 * 1000;
        return WOCHE[w] + ' ' + formatShort(aD) + ' A → ' + formatShort(lD) + ' L';
      }).join(' · ');
      return { text: seq, meta: 'Same-Day (L=A+7)' };
    } else {
      var n = Math.min(state.aDays.length, state.lDays.length);
      var firstA = today + 999 * 24 * 60 * 60 * 1000;
      for (var i = 0; i < n; i++) {
        var aDate = nextWeekdayFrom(today, state.aDays[i]);
        if (aDate < firstA) firstA = aDate;
      }
      var seqParts = [];
      for (var i = 0; i < n; i++) {
        var aDate = nextWeekdayFrom(today, state.aDays[i]);
        var tAL = tageAzuL(state.aDays[i], state.lDays[i]);
        var lDate = aDate + tAL * 24 * 60 * 60 * 1000;
        seqParts.push(WOCHE[state.aDays[i]] + ' ' + formatShort(aDate) + ' A, ' + WOCHE[state.lDays[i]] + ' ' + formatShort(lDate) + ' L');
      }
      return { text: seqParts.join(' · ') + ' · …', meta: 'Zuordnung 1:1' };
    }
  }

  function buildPreview() {
    state.aDays = getSelected(chipsA);
    state.lDays = getSelected(chipsL);

    if (state.aDays.length === 0 || state.lDays.length === 0) {
      nextTermin.textContent = 'Wähle A- und L-Tage.';
      previewSequence.innerHTML = 'Wähle mindestens einen <strong>A</strong>- und einen <strong>L</strong>-Tag.';
      previewMeta.textContent = '';
      blockSame.style.display = 'none';
      blockTageAzuL.style.display = 'none';
      return;
    }

    var sameSet = setsEqual(state.aDays, state.lDays);
    blockSame.style.display = sameSet ? 'block' : 'none';
    blockTageAzuL.style.display = sameSet ? 'none' : 'block';

    var next = computeNextTermin();
    if (next) {
      nextTermin.textContent = next.text;
      previewMeta.textContent = (next.meta || '') + ' · Intervall: ' + (state.intervallDays === 7 ? 'jede Woche' : 'alle ' + (state.intervallDays/7) + ' Wochen');
    }

    var parts = [];
    if (sameSet && state.sameDay === '0') {
      state.aDays.forEach(function(w) {
        parts.push(WOCHE[w] + ': <span class="tag al">A+L</span>');
      });
      previewSequence.innerHTML = parts.join(' · ') + ' · …';
    } else if (sameSet && state.sameDay === '7') {
      state.aDays.forEach(function(w) {
        parts.push(WOCHE[w] + ': <span class="tag a">A</span> → nächste ' + WOCHE[w] + ': <span class="tag l">L</span>');
      });
      previewSequence.innerHTML = parts.join(' · ');
    } else {
      var n = Math.min(state.aDays.length, state.lDays.length);
      for (var i = 0; i < n; i++) {
        parts.push(WOCHE[state.aDays[i]] + ' <span class="tag a">A</span>, ' + WOCHE[state.lDays[i]] + ' <span class="tag l">L</span>');
      }
      previewSequence.innerHTML = parts.join(' · ') + ' · …';
      if (state.aDays.length !== state.lDays.length) {
        previewMeta.textContent = (previewMeta.textContent || '') + ' A/L unterschiedlich: Zuordnung 1:1.';
      }
    }
  }

  function updateSameDayUI() {
    var r = document.querySelector('input[name="same"]:checked');
    if (r) state.sameDay = r.value;
    radioSame.classList.toggle('selected', state.sameDay === '0');
    radioWeek.classList.toggle('selected', state.sameDay === '7');
  }

  chipsA.querySelectorAll('.chip').forEach(function(c) {
    c.addEventListener('click', function() {
      c.classList.toggle('selected');
      buildPreview();
    });
  });
  chipsL.querySelectorAll('.chip').forEach(function(c) {
    c.addEventListener('click', function() {
      c.classList.toggle('selected');
      buildPreview();
    });
  });

  radioSame.addEventListener('click', function() {
    state.sameDay = '0';
    document.querySelector('input[name="same"][value="0"]').checked = true;
    updateSameDayUI();
    buildPreview();
  });
  radioWeek.addEventListener('click', function() {
    state.sameDay = '7';
    document.querySelector('input[name="same"][value="7"]').checked = true;
    updateSameDayUI();
    buildPreview();
  });

  chipsIntervall.querySelectorAll('.chip').forEach(function(c) {
    c.addEventListener('click', function() {
      state.intervallDays = parseInt(c.getAttribute('data-days'), 10);
      chipsIntervall.querySelectorAll('.chip').forEach(function(x) { x.classList.remove('selected'); });
      c.classList.add('selected');
      buildPreview();
    });
  });

  btnSave.addEventListener('click', function() {
    state.aDays = getSelected(chipsA);
    state.lDays = getSelected(chipsL);
    var msg = 'Demo gespeichert (Plan-Logik).\n\nA-Tage: ' + (state.aDays.length ? state.aDays.map(function(w){ return WOCHE[w]; }).join(', ') : '–') + '\n';
    msg += 'L-Tage: ' + (state.lDays.length ? state.lDays.map(function(w){ return WOCHE[w]; }).join(', ') : '–') + '\n';
    msg += 'sameDayLStrategy: ' + (setsEqual(state.aDays, state.lDays) ? state.sameDay : '– (nicht relevant)') + '\n';
    msg += 'Intervall: alle ' + (state.intervallDays/7) + ' Wochen';
    alert(msg);
  });

  updateSameDayUI();
  buildPreview();
})();
  </script>
</body>
</html>
