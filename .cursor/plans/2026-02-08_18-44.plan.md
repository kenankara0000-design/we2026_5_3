# Plan 2026-02-08

## Belege: Ein Beleg = ein Dokument mit Gesamtzahlen, Löschen nur über Kebab-Menü

### Analyse (Ist-Zustand)

- **Belege-Struktur:** Erfassungen sind bereits nach Monat gruppiert (`BelegMonat`: `monthKey`, `monthLabel`, `erfassungen`). Ein Beleg = ein Monat pro Kunde. Siehe [BelegMonatGrouping.kt](app/src/main/java/com/example/we2026_5/ui/wasch/BelegMonatGrouping.kt).
- **Anzeige im Beleg-Detail:** In [WaschenErfassungBelegDetailContent.kt](app/src/main/java/com/example/we2026_5/ui/wasch/WaschenErfassungBelegDetailContent.kt) wird **jede Erfassung einzeln** als eigene Card angezeigt (Datum/Zeit, Positionen, roter Button „Erfassung löschen“). Der Nutzer sieht also viele Karten statt eines zusammengehörigen Belegs.
- **Löschen:** Aktuell kann pro Erfassung gelöscht werden (Button auf jeder Card). Es gibt keine „Beleg löschen“-Funktion und kein Kebab-Menü (3 Punkte) mit Bestätigung.

### Ziele (Soll)

1. **Ein Beleg = ein Dokument:** Alle Erfassungen des Monats sollen als **ein** Beleg dargestellt werden (nicht jede Erfassung als eigene Karte). Inhalt: die einzelnen Erfassungen/Vorgänge (optional mit Datum/Zeit) und am **Ende des Belegs** eine **Gesamtzahl pro Artikel** (Summe der Mengen über alle Erfassungen des Monats).
2. **Beleg pro Monat:** Unverändert – jeder Beleg gilt nur für einen Monat (bereits so umgesetzt).
3. **Beleg löschen:** Nur wenn ein Beleg geöffnet ist, über ein **Kebab-Menü (3 Punkte)** erreichbar, mit **Bestätigungsdialog**. Einzelne-Erfassung-löschen-Buttons in der Beleg-Ansicht entfernen (oder nur über Menü pro Erfassung, je nach gewünschter Logik; sinnvoll: „Beleg löschen“ = gesamten Monat/alle Erfassungen des Belegs löschen).

### Geplante Schritte

- **UI Beleg-Detail:** Darstellung umbauen: Statt einer Card pro Erfassung entweder eine zusammenhängende Liste (z. B. Abschnitt pro Erfassung ohne große Karten) und **am Ende** einen Block „Gesamt“ mit aggregierten Mengen pro Artikel (Artikelname, Summe Menge, Einheit). Aggregation: über alle `erfassungen` des Belegs die `positionen` nach `articleId` gruppieren und Mengen summieren; Einheit aus erster Position oder Artikel nehmen.
- **Gesamtzahlen:** Logik in ViewModel oder in der UI: aus `erfassungen.flatMap { it.positionen }` nach `articleId` gruppieren, `menge` summieren, mit Artikelnamen (über `articlesMap`) anzeigen.
- **Kebab-Menü:** In der Beleg-Detail-Ansicht (TopBar oder Kopfbereich) ein Icon „3 Punkte“ (MoreVert), Dropdown mit Eintrag „Beleg löschen“. Nur in diesem geöffneten Beleg-Kontext sichtbar.
- **Beleg löschen:** Aktion „Beleg löschen“ öffnet Bestätigungsdialog (z. B. „Gesamten Beleg für [Monat] löschen? Alle X Erfassungen werden entfernt.“). Bei Bestätigung: alle Erfassungen des aktuellen Belegs (alle IDs in `erfassungen`) nacheinander über `ErfassungRepository.deleteErfassung` löschen; danach zurück zur Beleg-Liste (bzw. Belege-Liste). BelegeViewModel/ErfassungRepository bereits mit `deleteErfassung(erfassungId)` vorhanden – erweitern um „alle Erfassungen eines Belegs löschen“ oder in Activity/ViewModel Schleife aufrufen.
- **Entfernen:** Die roten „Erfassung löschen“-Buttons pro Erfassung in `WaschenErfassungBelegDetailContent` entfernen (damit Löschen nur noch über „Beleg löschen“ im Kebab-Menü mit Bestätigung erfolgt). Falls gewünscht: optional „Einzelne Erfassung löschen“ als weiteren Menüpunkt im Kebab oder pro Zeile nur bei langem Drücken – im Plan erstmal nur „Beleg löschen“ über Menü.

### Betroffene Dateien (ohne Code)

- [WaschenErfassungBelegDetailContent.kt](app/src/main/java/com/example/we2026_5/ui/wasch/WaschenErfassungBelegDetailContent.kt): Darstellung auf einen Beleg umstellen, Gesamtblock am Ende, Kebab-Menü (3 Punkte), Buttons „Erfassung löschen“ entfernen.
- [BelegeViewModel.kt](app/src/main/java/com/example/we2026_5/ui/wasch/BelegeViewModel.kt) bzw. [WaschenErfassungViewModel.kt](app/src/main/java/com/example/we2026_5/ui/wasch/WaschenErfassungViewModel.kt): Neue Aktion „Beleg löschen“ (alle Erfassungen des Monats löschen), ggf. Callback für Bestätigung; BelegeScreen/WaschenErfassungScreen: Dialog und Aufruf der Löschaktion.
- [BelegeActivity.kt](app/src/main/java/com/example/we2026_5/BelegeActivity.kt) / [WaschenErfassungActivity.kt](app/src/main/java/com/example/we2026_5/WaschenErfassungActivity.kt): Bestätigungsdialog für „Beleg löschen“ anbinden.
- Strings: ggf. neue Einträge z. B. `beleg_loeschen`, `dialog_beleg_loeschen_title`, `dialog_beleg_loeschen_message`, `gesamt` (für Gesamtzahlen-Überschrift).
