---
name: ""
overview: ""
todos: []
isProject: false
---

# Plan: Überfällig-Logik vereinheitlichen

**Erstellt:** 2026-02-13  
**Status:** Warte auf Nutzer-Zustimmung

---

## Ziel

Die Überfällig-Logik der App an die beschriebene Regel anpassen: einheitlich für alle Kundentypen (Gewerblich, Privat, Listenkunden inkl. aus Listen ohne Wochentag), A/L getrennt prüfen, Badge A/L neben „Überfällig“ auf der Karte. Keine Änderung ohne Freigabe.

---

## Soll-Regel (Referenz)

- **Überfällig:** Am Fälligkeitsdatum nicht erledigt, und (A oder L oder A+L) → Termin gilt überfällig.
- **Anzeige:** Immer am Fälligkeitstag und am Tag „Heute“, bis erledigt.
- **Kundentyp:** Gewerblich, Privat, Listenkunden (inkl. aus Listen ohne Wochentag) – gleiche Regel.
- **Badge:** Neben der Überfällig-Badge auf der Karte anzeigen, ob A oder L oder beides überfällig ist (für alle, auch Listenkunden).

---

## Abgleich: Regel vs. App


| Thema                                         | Soll                                                                 | Ist (App)                                                                 | Handlung                                                                                                             |
| --------------------------------------------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| A erledigt, L offen                           | Kunde weiter als überfällig (für L) anzeigen.                        | Sobald A **oder** L erledigt → nicht überfällig.                          | Überfällig pro Termin-Typ (A/L) prüfen; Kunde überfällig, wenn **irgendein** überfälliger A oder L noch offen.       |
| Listen ohne Wochentag in Sektion „Überfällig“ | Auch Listenkunden aus Listen ohne Wochentag in Sektion „Überfällig“. | Nur G/P ohne Liste + Wochentagslisten; Listen ohne Wochentag ausgelassen. | Kunden aus Listen ohne Wochentag mit überfälligem A/L in `alleUeberfaelligeKunden` / Sektion „Überfällig“ aufnehmen. |
| Badge A/L neben „Überfällig“                  | Auf der Karte neben „Überfällig“: A / L / A+L.                       | Nur „Überfällig“ auf Karte; A/L nur im Erledigung-Sheet.                  | Auf der Karte (und bei Listenkunden gleich) neben Überfällig-Badge die Info A / L / A+L anzeigen.                    |
| Fälligkeitstag + Heute                        | Überfällige am Fälligkeitstag und am Heute-Tag.                      | Bereits so (sollUeberfaelligAnzeigen).                                    | Keine Änderung.                                                                                                      |


---

## Geplante Schritte (nach Zustimmung)

1. **TourDataFilter.kt – `istKundeUeberfaellig**`
  Überfällig nicht mehr am Gesamt-Kunden-Status (abholungErfolgt || auslieferungErfolgt) festmachen, sondern pro Termin-Typ: Kunde überfällig, wenn mindestens ein überfälliger A-Termin **oder** ein überfälliger L-Termin noch nicht erledigt ist. Abhängige Stellen (z. B. Erledigt-Prüfung, „am Tag relevant“) prüfen, damit nichts kaputt geht.
2. **TourDataProcessor.kt – Sektion „Überfällig“**
  Beim Befüllen von `alleUeberfaelligeKunden` zusätzlich Kunden aus **Listen ohne Wochentag** (Listen mit wochentag außerhalb 0..6, Listenkunden-Listen) einbeziehen, sofern sie laut Filter überfällig sind. Doppelte pro Kunde vermeiden (distinctBy bleibt).
3. **Badge neben „Überfällig“ auf der Karte**
  In der Kundenzeile (TourPlannerCustomerRow bzw. wo die Überfällig-Badge gesetzt wird): Wenn `isOverdue == true`, zusätzlich anzeigen, ob A, L oder A+L überfällig sind (z. B. „Ü (A)“, „Ü (L)“, „Ü (A+L)“ oder Nutzung bestehender Strings). Gleiche Logik für Listenkunden (TourListeCardRow / getStatusBadgeText oder ergänzende Info). Datenquelle: gleiche Logik wie im Erledigung-Sheet (overdueInfoText / hatUeberfaelligeAbholung, hatUeberfaelligeAuslieferung).
4. **Tests & BEKANNTE_FEHLER.md**
  Nach Umsetzung: zwei Einträge in BEKANNTE_FEHLER.md als behoben markieren (Listen ohne Wochentag nicht in Überfällig; A erledigt / L offen nicht überfällig).

---

## Relevante Dateien (ohne Code)

- `tourplanner/TourDataFilter.kt` – istKundeUeberfaellig
- `tourplanner/TourDataProcessor.kt` – alleUeberfaelligeKunden, overdueGewerblich, Wochentagslisten-Schleife
- `ui/tourplanner/TourPlannerCustomerRow.kt` – Badge-Text bei isOverdue
- `adapter/CustomerButtonVisibilityHelper.kt` – overdueInfoText, hatUeberfaelligeAbholung/Auslieferung
- `tourplanner/TourPlannerStatusBadge.kt` – Badge-Text (evtl. für A/L bei Ü)
- `BEKANNTE_FEHLER.md` – Einträge nach Fix aktualisieren

---

**Nächster Schritt:** Deine Zustimmung abwarten; danach Umsetzung der Schritte 1–4.