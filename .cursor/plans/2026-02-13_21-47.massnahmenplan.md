# Konsolidierter MaÃŸnahmenplan â€“ Alle Analysen (01â€“09)

**Erstellt:** 2026-02-13  
**Grundlage:** Analysen 01â€“09 (Design, Code, KompatibilitÃ¤t, UX, Flow, Info, Offline, Fehler, Performance)  
**Status:** Phase 1 âœ… abgeschlossen (2026-02-13). Phase 2 âœ… abgeschlossen (2026-02-13). Phase 3 âœ… abgeschlossen (2026-02-13). Phase 4+ offen â€“ keine Umsetzung ohne Freigabe.  
**Ersetzt:** `2026-02-13_21-02.plan.md` (Abschnitt 17) und `2026-02-13_21-44.plan.md` (als EinzelplÃ¤ne)

---

## Priorisierung

| Prio | Bedeutung | Kriterium |
|------|-----------|-----------|
| ðŸ”´ | Kritisch | Funktion defekt, stiller Fehler, Nutzer wird blockiert |
| ðŸŸ¡ | Mittel | Bedienbarkeit, fehlende Info, inkonsistent, umstÃ¤ndlich |
| ðŸŸ¢ | Niedrig | Kosmetik, Langfrist, Tech-Debt, â€žnice to have" |

---

## Ãœbersicht: 8 Phasen

| Phase | Thema | Aufgaben | Aufwand |
|-------|-------|----------|---------|
| 1 | Sofort-Fixes (stille Fehler + Offline) âœ… | 9 | 1â€“2 Wochen |
| 2 | Design-System Grundlagen âœ… | 10 | 1â€“2 Wochen |
| 3 | Wiederverwendbare Composables + Error-Handling âœ… | 11 | 2â€“3 Wochen |
| 4 | Karten-Infos + User-Flow | 8 | 1â€“2 Wochen |
| 5 | ViewModel-Refactoring | 6 | 2â€“3 Wochen |
| 6 | Navigation + LiveData-Migration | 6 | 2â€“3 Wochen |
| 7 | Repository + Business-Logik | 6 | 2â€“3 Wochen |
| 8 | AufrÃ¤umen + Langfrist | 17 | fortlaufend |
| **Gesamt** | | **73** | **~12â€“18 Wochen** |

---

## Phase 1: Sofort-Fixes (1â€“2 Wochen) âœ… ERLEDIGT (2026-02-13)

*Stille Fehler, defekte States, fehlende Offline-Hinweise. Kann sofort und unabhÃ¤ngig umgesetzt werden.*

| Nr. | Aufgabe | Prio | Quelle | Details |
|-----|---------|------|--------|---------|
| **1.01** | `_isLoading` im TourPlannerViewModel korrekt setzen | ðŸ”´ | A08, A09 | Wird nie auf `true` gesetzt â†’ LoadingView nie sichtbar |
| **1.02** | `_isLoading` im CustomerManagerViewModel korrekt setzen | ðŸ”´ | A08, A09 | Gleiches Problem; `loadCustomers()` ist leer |
| **1.03** | Stiller Fehler: `getSheetState == null` â†’ Feedback | ðŸ”´ | A08 | TourPlanner: â€žAktionen" tut nichts wenn `displayedDateMillis == null` |
| **1.04** | Stiller Fehler: `_customerId ?: return` â†’ Feedback | ðŸ”´ | A08 | CustomerDetail: `saveCustomer` bricht ohne Meldung ab |
| **1.05** | KundenpreiseScreen: Back zur Suche ermÃ¶glichen | ðŸ”´ | A05 | `onBackToKundeSuchen` existiert, wird nicht genutzt |
| **1.06** | SevDesk-Import: Offline-Hinweis + Buttons deaktivieren | ðŸ”´ | A07 | Einziger Screen der Netzwerk braucht â€“ kein Hinweis |
| **1.07** | Kundendetail: Offline-Badge in TopBar | ðŸŸ¡ | A07 | NetworkMonitor nicht genutzt |
| **1.08** | Erfassung: Offline-Hinweis | ðŸŸ¡ | A07 | Funktioniert offline, aber Nutzer weiÃŸ das nicht |
| **1.09** | Offline-Farbe zentralisieren | ðŸŸ¢ | A01, A07 | `Color(0xFFFFEB3B)` â†’ `colorResource(R.color.offline_yellow)` |

---

## Phase 2: Design-System Grundlagen (1â€“2 Wochen) âœ… ERLEDIGT (2026-02-13)

*Zentrale Farben, Typografie, Spacing. Basis fÃ¼r alle weiteren Phasen.*

| Nr. | Aufgabe | Prio | Quelle | Details |
|-----|---------|------|--------|---------|
| **2.01** | `AppTheme.kt` erstellen | ðŸŸ¡ | A01 | âœ… `ui/theme/AppTheme.kt` â€“ MaterialTheme-Wrapper mit ColorScheme + Typography |
| **2.02** | `AppColors.kt` erstellen | ðŸŸ¡ | A01 | âœ… `ui/theme/AppColors.kt` â€“ Alle Farb-Konstanten zentralisiert |
| **2.03** | `AppTypography.kt` erstellen | ðŸŸ¡ | A01 | âœ… `ui/theme/AppTypography.kt` â€“ 9 Stufen (28/20/18/16/14/12/10 sp) |
| **2.04** | `AppSpacing.kt` erstellen | ðŸŸ¡ | A01 | âœ… `ui/theme/AppSpacing.kt` â€“ Screen/Card/Field/Section + Compact-ExtraLarge |
| **2.05** | Hardcodierte Farben ersetzen (~10 Stellen) | ðŸŸ¡ | A01 | âœ… 13 Dateien, ~25 Ersetzungen â†’ `AppColors.*` |
| **2.06** | MaterialTheme-Wrapper in alle Activities einbauen | ðŸŸ¡ | A01 | âœ… 24 Activities (8 neu + 13 ersetzt + 3 Extra) |
| **2.07** | Doppelte Farben in `colors.xml` konsolidieren | ðŸŸ¢ | A01 | âœ… `error_red` â†’ Alias `@color/status_overdue`; `button_auslieferung` â†’ Alias `@color/status_done` |
| **2.08** | Ungenutzte Farben entfernen | ðŸŸ¢ | A01 | âœ… `purple_500` entfernt |
| **2.09** | Extension `Intent.requireStringExtra()` | ðŸŸ¢ | A02 | âœ… `util/AppExtensions.kt` |
| **2.10** | Extension `Context.showToast()` | ðŸŸ¢ | A02 | âœ… `util/AppExtensions.kt` (String + ResId Variante) |

---

## Phase 3: Wiederverwendbare Composables + Error-Handling (2â€“3 Wochen) âœ… ERLEDIGT (2026-02-13)

*Einheitliche UI-Bausteine erstellen und Error/Loading fÃ¼r alle Screens nachrÃ¼sten.*

| Nr. | Aufgabe | Prio | Quelle | Details |
|-----|---------|------|--------|---------|
| **3.01** | `AppTopBar` Composable erstellen | ðŸŸ¡ | A01, A02 | âœ… `ui/common/AppTopBar.kt` â€“ Standard-TopBar mit Back, Titel, Actions |
| **3.02** | `AppLoadingView`, `AppErrorView`, `AppEmptyView` erstellen | ðŸŸ¡ | A01, A08 | âœ… `ui/common/AppStateViews.kt` â€“ Einheitlich fÃ¼r alle Screens |
| **3.03** | `AppPrimaryButton`, `AppSecondaryButton` erstellen | ðŸŸ¡ | A01 | âœ… `ui/common/AppButtons.kt` â€“ Einheitliche Button-Konfiguration |
| **3.04** | `AppCard` Composable erstellen | ðŸŸ¢ | A01 | âœ… `ui/common/AppCard.kt` â€“ Standard-Card mit Padding/Elevation |
| **3.05** | Alle Screens auf neue Composables umstellen | ðŸŸ¡ | A01 | âœ… 14 Screens auf AppTopBar; 4 State-View-Dateien auf AppStateViews |
| **3.06** | Loading-States nachrÃ¼sten (fehlende Screens) | ðŸŸ¡ | A08 | âœ… ArtikelVerwaltungVM, KundenpreiseVM, BelegeVM + AusnahmeTerminActivity |
| **3.07** | Error-States nachrÃ¼sten (fehlende Screens) | ðŸŸ¡ | A08 | âœ… ArtikelVerwaltungScreen, KundenpreiseScreen (via ViewModel errorMessage) |
| **3.08** | Generische Fehlermeldungen verbessern | ðŸŸ¡ | A08 | âœ… AppErrorMapper: Context-Varianten + 11 neue spezifische Strings |
| **3.09** | Foto-Upload: Pending-Status sichtbar machen | ðŸŸ¡ | A07, A08 | âœ… WorkManager-Tag + Pending-Anzeige in CustomerDetailFotosSection |
| **3.10** | Hardcodierte Strings ersetzen | ðŸŸ¢ | A02 | âœ… DialogBaseHelper: "Ja"/"Abbrechen" â†’ getString(R.string.*) |
| **3.11** | `AppLogger`: `BuildConfig.DEBUG` statt hardcoded `true` | ðŸŸ¢ | A02 | âœ… `ENABLED = BuildConfig.DEBUG` |

---

## Phase 4: Karten-Infos + User-Flow (1â€“2 Wochen)

*Fehlende Infos auf Karten ergÃ¤nzen, hÃ¤ufigste Aktionen verkÃ¼rzen.*

| Nr. | Aufgabe | Prio | Quelle | Details |
|-----|---------|------|--------|---------|
| **4.01** | Tour-Karte: Adresse anzeigen | ðŸŸ¡ | A06 | 1 Zeile unter Name â€“ Fahrer sieht wohin |
| **4.02** | Kundenliste: Status-Badge (Pausiert/Ad-hoc) | ðŸŸ¡ | A06 | Badge neben Kundenart |
| **4.03** | Kundendetail Stammdaten-Tab: ÃœberfÃ¤llig-Hinweis | ðŸŸ¡ | A06 | `statusOverdue` wird Ã¼bergeben, aber nicht angezeigt |
| **4.04** | Erledigung: Direkter Zugang ohne Zwischen-Dialog | ðŸŸ¡ | A05 | Karte-Klick â†’ direkt â€žAktionen"; Overview als Long-Press |
| **4.05** | Erfassung Kunden-Suche: Adresse/Alias anzeigen | ðŸŸ¢ | A06 | Verwechslungsgefahr bei Ã¤hnlichen Namen |
| **4.06** | Tour-Karte: Telefon anzeigen (optional) | ðŸŸ¢ | A06 | Klickbar fÃ¼r Schnellanruf |
| **4.07** | Kundendetail: â€žNÃ¤chster Kunde" reaktivieren | ðŸŸ¢ | A05 | `showSaveAndNext = false` prÃ¼fen |
| **4.08** | Erfassung: Shortcut aus Kundendetail | ðŸŸ¢ | A05 | Belege-Tab â†’ direkt Erfassung |

---

## Phase 5: ViewModel-Refactoring (2â€“3 Wochen)

*ViewModels konsistenter machen, doppelten Code extrahieren.*

| Nr. | Aufgabe | Prio | Quelle | Details |
|-----|---------|------|--------|---------|
| **5.01** | `BaseViewModel` erweitern: `isLoading`, `errorMessage`, `handleResult()` | ðŸŸ¡ | A02 | Standard-Patterns fÃ¼r alle ViewModels |
| **5.02** | `CustomerSearchHelper` extrahieren | ðŸŸ¡ | A02 | Aus WaschenErfassungVM + BelegeVM |
| **5.03** | `PriceLoadingUtils` extrahieren | ðŸŸ¢ | A02 | |
| **5.04** | `ErfassungFlowCollector` extrahieren | ðŸŸ¢ | A02 | |
| **5.05** | Stille `return`s durch Error-States ersetzen | ðŸŸ¡ | A02, A08 | Alle `?: return` mit Feedback versehen |
| **5.06** | `AppErrorMapper` Ã¼berall einsetzen | ðŸŸ¢ | A02 | |

---

## Phase 6: Navigation + LiveData-Migration (2â€“3 Wochen)

*Technische Schuld abbauen: Navigation zentralisieren, LiveData â†’ StateFlow.*

| Nr. | Aufgabe | Prio | Quelle | Details |
|-----|---------|------|--------|---------|
| **6.01** | Alle direkten Intents auf `AppNavigation` umstellen | ðŸŸ¡ | A02 | ~15 Activities |
| **6.02** | LiveData â†’ StateFlow: `AddCustomerViewModel` | ðŸŸ¢ | A02 | |
| **6.03** | LiveData â†’ StateFlow: `TourPlannerViewModel` | ðŸŸ¢ | A02 | |
| **6.04** | LiveData â†’ StateFlow: `CustomerManagerViewModel` | ðŸŸ¢ | A02 | |
| **6.05** | LiveData â†’ StateFlow: `MainViewModel` | ðŸŸ¢ | A02 | |
| **6.06** | LiveData â†’ StateFlow: `StatisticsVM`, `MapVM`, `ListeErstellenVM` | ðŸŸ¢ | A02 | |

---

## Phase 7: Repository + Business-Logik (2â€“3 Wochen)

*Repositorys standardisieren, groÃŸe Dateien aufteilen.*

| Nr. | Aufgabe | Prio | Quelle | Details |
|-----|---------|------|--------|---------|
| **7.01** | Repository-Return-Typen standardisieren (`Result<T>`) | ðŸŸ¡ | A02 | |
| **7.02** | `FirebaseRetryHelper` in allen Repositories | ðŸŸ¢ | A02 | |
| **7.03** | Parser extrahieren (`ErfassungSnapshotParser`, `KundenListeSnapshotParser`) | ðŸŸ¢ | A02 | |
| **7.04** | `TourDataProcessor` aufteilen (482 â†’ 2â€“3 Dateien) | ðŸŸ¢ | A02 | |
| **7.05** | `TerminBerechnungUtils` aufteilen (502 â†’ 2 Dateien) | ðŸŸ¢ | A02 | |
| **7.06** | ÃœberfÃ¤llig-Erkennung konsolidieren (1 Source of Truth) | ðŸŸ¡ | A02 | |

---

## Phase 8: AufrÃ¤umen + Langfrist (fortlaufend)

*Niedrige PrioritÃ¤t â€“ bei Gelegenheit oder im Rahmen anderer Arbeiten.*

| Nr. | Aufgabe | Prio | Quelle | Details |
|-----|---------|------|--------|---------|
| **8.01** | Migrations-Code prÃ¼fen: erledigt? â†’ archivieren | ðŸŸ¢ | A02 | |
| **8.02** | `FirebaseSyncManager` (No-Op) entfernen | ðŸŸ¢ | A02 | |
| **8.03** | View-basierte Layouts prÃ¼fen/entfernen | ðŸŸ¢ | A02 | |
| **8.04** | `TourPlannerDialogHelper` â†’ Compose-Dialoge | ðŸŸ¢ | A02 | |
| **8.05** | `TabSwipeFrameLayout` prÃ¼fen/entfernen | ðŸŸ¢ | A02 | |
| **8.06** | Ungenutzte Strings bereinigen | ðŸŸ¢ | A02 | |
| **8.07** | Dependencies aktualisieren (Compose BOM, Lifecycle, Koin, Firebase) | ðŸŸ¢ | A03 | |
| **8.08** | Datenmodell-Validierung (`Customer.validate()`) | ðŸŸ¢ | A02 | |
| **8.09** | Button-HÃ¶hen vereinheitlichen (48/56/64/72dp â†’ Standard) | ðŸŸ¢ | A04 | Profitiert von Phase 2 (Design-System) |
| **8.10** | `forEach` â†’ `LazyColumn` (ListeBearbeiten, BelegDetail, Urlaub) | ðŸŸ¢ | A04, A09 | Erst bei groÃŸen Datenmengen relevant |
| **8.11** | `derivedStateOf` im TourPlannerViewModel | ðŸŸ¢ | A09 | Recomposition optimieren |
| **8.12** | Paging bei 500+ Kunden vorbereiten | ðŸŸ¢ | A09 | Bei tatsÃ¤chlichem Bedarf |
| **8.13** | Back-Button in TopBar (tief verschachtelte Screens) | ðŸŸ¢ | A04 | System-Back funktioniert; TopBar-Pfeil = â€žnice to have" |
| **8.14** | `contentDescription` bei Icons | ðŸŸ¢ | A04 | Barrierefreiheit |
| **8.15** | ArtikelVerwaltung: Delete-Button aktivieren oder entfernen | ðŸŸ¢ | A04 | `enabled = false` â†’ klÃ¤ren |
| **8.16** | StatisticsScreen: Sleep-Mode prÃ¼fen | ðŸŸ¢ | A04 | Absichtlich deaktiviert? |
| **8.17** | Accessibility: WCAG-Kontrast prÃ¼fen | ðŸŸ¢ | A01 | |

---

## Empfohlene Reihenfolge

```
Phase 1 â”€â”€â†’ Phase 2 â”€â”€â†’ Phase 3 â”€â”€â†’ Phase 4
(sofort)    (Basis)     (baut auf    (baut auf
                         2 auf)       3 auf)

                         Phase 5 â”€â”€â†’ Phase 6 â”€â”€â†’ Phase 7
                         (parallel    (danach)    (danach)
                          zu 3â€“4)

                                                  Phase 8
                                                  (fortlaufend)
```

**Phase 1** kann sofort starten â€“ keine AbhÃ¤ngigkeiten.  
**Phase 2** kann parallel zu Phase 1 starten.  
**Phase 3â€“4** brauchen Phase 2 (Design-System).  
**Phase 5â€“7** kÃ¶nnen parallel zu 3â€“4 laufen (technische Schuld).  
**Phase 8** fortlaufend, bei Gelegenheit.

---

## Zusammenfassung nach PrioritÃ¤t

| PrioritÃ¤t | Aufgaben | Phasen |
|-----------|----------|--------|
| ðŸ”´ Kritisch | 6 | Phase 1 |
| ðŸŸ¡ Mittel | 27 | Phase 1â€“7 |
| ðŸŸ¢ Niedrig | 40 | Phase 2â€“8 |
| **Gesamt** | **73** | **~12â€“18 Wochen** |

---

*Dieser Plan dient als Referenz. Keine Ã„nderung ohne ausdrÃ¼ckliche Freigabe (vgl. `.cursor/rules/nicht-kaputt-machen.mdc`).*
