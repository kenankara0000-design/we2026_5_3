---
name: ""
overview: ""
todos: []
isProject: false
---

# Plan: Termine-Tab Kunden-Detail – Eine Sektion „Alle Termine“, + Termin Chip

**Erstellt:** 2026-02-10 23:14  
**Ergänzt:** Bestätigung „Alle Termine“ (eine Überschrift, alle Termin-Arten, gleiches Design wie Aktionen-Dialog)

## Ziele

1. **Alle getrennten Bereiche entfernen:** „Nächster Termin“, „Kunden-Termine“, „Ausnahme-Termine“, „Termin-Regel“ (Text + Bereich jeweils komplett).
2. **Eine Überschrift „Alle Termine“** mit **einer gemeinsamen Liste**: alle möglichen Termin-Arten dieses Kunden (Regeltermine, Unregelmäßige, Monthly-Weekday, Listen, Ausnahme-Termine, einmalige Kunden-Termine) – **genau wie der Termine-Tab im Aktionen-Dialog** (gleiche Datenquelle/Logik, gleiches Zeilen-Design).
3. **"+ Termin"-Button** als **viereckig gerundeter Chip-Button** (kein FAB).

---

## 0. Bestätigter Inhalt (vor dem Bauen)

- **Entfernen:** Überschrift + Bereich „Kunden-Termine“, „Ausnahme-Termine“, „Termin-Regel“, sowie „Nächster Termin“.
- **Neu:** Nur **eine** Überschrift **„Alle Termine“**; darunter **eine** Liste mit allen Terminen des Kunden (berechnet + kundenTermine + ausnahmeTermine), **gleiche Darstellung** wie im Termine-Tab des Aktionen-Dialogs (ErledigungSheet): Zeilen mit A/L-Badges, `background_light`, Datum kurz mit Jahr.
- **Warten:** Umsetzung erst nach Freigabe durch Nutzer.

**Ergänzung (Anzeige, Höhe, Ort, Löschen):**

- **Eine Überschrift „Alle Termine“**; Inhalt **scrollbar**.
- **Maximal 6 Termin-Paare** sichtbar: eine Zeile = A-Termin + L-Termin (Tag), wie im Termine-Tab. Der Bereich hat eine **maximale Höhe für 6 Zeilen**; bei mehr Paaren ist der **Rest scrollbar**.
- **Derselbe „Alle Termine“-Bereich** (Überschrift + scrollbare Liste, max. 6 Zeilen Höhe) wird **auch in der Kundenübersicht** angezeigt (z. B. im ersten Tab / Stammdaten-Übersicht).
- **Termine löschen** ist **nur im Bearbeitungsmodus** erlaubt; in reiner Ansicht keine Lösch-Buttons/Aktionen.

---

## 1. Nächster Termin, Kunden-Termine, Ausnahme-Termine, Termin-Regel entfernen

**Datei:** `app/src/main/java/com/example/we2026_5/ui/detail/CustomerDetailTermineTab.kt`

- **CustomerDetailNaechsterTermin** (Überschrift „Nächster Termin:“ + graues Datumsfeld) – Aufruf entfernen.
- **CustomerDetailKundenTermineSection** (Überschrift „Kunden-Termine“ + Bereich) – Aufruf entfernen.
- **CustomerDetailAusnahmeTermineSection** (Überschrift „Ausnahme-Termine“ + Bereich) – Aufruf entfernen.
- **CustomerDetailTerminRegelCard** („Termin-Regel“ + Intervalle/Regeln-Bereich) – Aufruf entfernen.
- Zugehörige Parameter/Callbacks prüfen und aus Signatur/Aufrufern entfernen, sofern nur für diese Bereiche genutzt (onDeleteNextTermin, onDeleteAusnahmeTermin, onDeleteKundenTermin, onAddAbholungTermin, onRegelClick, onRemoveRegel, onResetToAutomatic, onTerminAnlegen, onAddMonthlyClick, AddMonthly-Sheet, NeuerTerminArtSheet-Parameter ggf. behalten für „+ Termin“).
- **CustomerDetailKundenTypSection** (effectiveAbholungWochentage etc.): prüfen, ob entfernt oder als kleines Info-Block behalten.
- Referenzprüfung vor Löschen: CustomerDetailNaechsterTermin.kt, CustomerDetailKundenTermineSection.kt, CustomerDetailAusnahmeTermineSection.kt, CustomerDetailTerminRegelCard – ob woanders verwendet; wenn nur hier, können Composable-Dateien später bereinigt werden.

**Betroffene Stellen:** CustomerDetailScreen.kt, CustomerDetailViewModel.kt (Callbacks/Parameter anpassen).

---

## 2. Eine Sektion „Alle Termine“ (gleiche Daten + Design wie Aktionen-Dialog Termine-Tab)

**Referenz:** `ErledigungTabTerminContent.kt` + `TerminCache.getTerminePairs365(customer, liste)`.

- **Daten:** Dieselbe Logik wie im Aktionen-Dialog: alle Termin-Arten merged (berechnete Termine aus Intervall/Wochentag/Listen/Monthly-Weekday + kundenTermine + ausnahmeTermine), nächste 365 Tage, sortiert. Dafür im Kunden-Detail `getTerminePairs365` nutzen – entweder TerminCache/Listen-Kontext an CustomerDetail übergeben oder eine shared Util-Funktion.
- **UI:** Eine Überschrift „Alle Termine“ (String in strings.xml, z. B. `label_alle_termine`).
- **Liste:** Gleiches Zeilen-Design wie ErledigungTabTerminContent: pro A/L-Paar **eine Zeile** (A-Termin + L-Termin Tag), mit `background_light`, `MaterialTheme.shapes.small`, A-Badge, L-Badge, `DateFormatter.formatDateShortWithYear`. Leerzustand: „Keine Termine“.
- **Höhe & Scroll:** Bereich **maximal für 6 Termin-Paare** (feste max. Höhe, z. B. 6 × Zeilenhöhe); bei mehr als 6 Paaren ist der **Inhalt scrollbar** (z. B. `Column` mit `verticalScroll` und `heightIn(max = …)` oder `Modifier.height(…)` mit `verticalScroll`).
- **Ort:** Dieselbe Sektion (Überschrift + scrollbare Liste, max. 6 Zeilen sichtbar) wird an **zwei Stellen** eingeblendet: **(1)** Termine-Tab im Kunden-Detail, **(2)** Kundenübersicht (z. B. erster Tab / Stammdaten-Übersicht). Gemeinsame Composable verwenden (z. B. `AlleTermineBlock(pairs, canDelete, …)`).
- **Löschen:** Termine löschen **nur im Bearbeitungsmodus** erlaubt. Parameter `canDeleteTermin: Boolean` (z. B. an `isInEditMode` gekoppelt); in Ansicht (`canDeleteTermin == false`) keine Lösch-Buttons/IconButtons anzeigen.
- **Wiederverwendung:** Ausgelagerte Composable „TerminZeilenListe“ oder „AlleTermineBlock“ für Aktionen-Dialog-Design, max. 6 Zeilen Höhe, Scroll, optional Delete – nutzbar im Termine-Tab und in der Kundenübersicht.

---

## 3. "+ Termin" als gerundeter Chip-Button

**Vorgabe:** Rounded-Rechteck-Chip (nicht runder FAB), wie im zweiten Screenshot für „Neu Termin button“ angedeutet.

**Datei:** `app/src/main/java/com/example/we2026_5/ui/detail/CustomerDetailTermineTab.kt`

- **FloatingActionButton** (FAB) für „Neuer Termin“ entfernen, wenn `useCentralNeuerTermin == true`.
- Stattdessen einen **Chip-Button** „+ Termin“ einbauen:
  - Position: z. B. direkt unter **CustomerDetailStatusSection** (unter der „Aktiv“-Zeile) oder oben im Termin-Bereich, so dass er sichtbar im Scroll-Bereich liegt (kein FAB).
  - Optik: `Surface` oder `Button` mit `shape = RoundedCornerShape(…)` (z. B. 20.dp oder 24.dp für Chip-Look), kompakte Höhe, Text „+ Termin“ (String in `strings.xml` prüfen: `label_neu_termin` = „Neu Termin“; ggf. neuen String `label_plus_termin` = „+ Termin“ anlegen).
  - `onClick` = gleiche Aktion wie bisher FAB: `onNeuerTerminClick`.
- Wenn **nicht** `useCentralNeuerTermin`: In `CustomerDetailKundenTermineSection` bleibt der bisherige „Neu Termin“-Button; dieser kann optional ebenfalls als gleicher Chip-Stil umgesetzt werden (einheitliches Erscheinungsbild).

**Strings:** Ggf. in `res/values/strings.xml` einen Eintrag für „+ Termin“ ergänzen, falls gewünscht (z. B. `label_plus_termin`), und in der Composable verwenden.

---

## 4. Abhängigkeiten und Reihenfolge


| Schritt | Aktion                                                                                                                                                         | Dateien                                                                          |
| ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| 1       | Alle vier Bereiche entfernen (Nächster Termin, Kunden-Termine, Ausnahme-Termine, Termin-Regel); Callbacks/Parameter bereinigen                                 | CustomerDetailTermineTab.kt, CustomerDetailScreen.kt, CustomerDetailViewModel.kt |
| 2       | „Alle Termine“-Block: Überschrift + Liste (max. 6 Zeilen sichtbar, rest scrollbar), gleiches Design; auch in Kundenübersicht; Löschen nur im Bearbeitungsmodus | Gemeinsame Composable (Termine-Tab + Kundenübersicht), TerminCache/Listen-Zugang |
| 3       | FAB durch Chip „+ Termin“ ersetzen                                                                                                                             | CustomerDetailTermineTab.kt, ggf. strings.xml                                    |


Referenzprüfung vor dem Entfernen der Composable-Aufrufe gemäß Regel „Nichts kaputt machen“.

---

## 5. Kurzfassung

- **Entfernen:** „Nächster Termin“, „Kunden-Termine“, „Ausnahme-Termine“, „Termin-Regel“ (jeweils Überschrift + gesamter Bereich).
- **Neu:** Eine Überschrift **„Alle Termine“** und **eine** inhaltlich scrollbare Liste (eine Zeile = A-Termin + L-Termin Tag wie im Termine-Tab). **Max. 6 Termin-Paare** sichtbar, Rest scrollbar. **Derselbe Bereich** erscheint im **Termine-Tab** und in der **Kundenübersicht**. **Löschen** von Terminen **nur im Bearbeitungsmodus**.
- **Button:** „+ Termin“ als viereckig gerundeter Chip-Button (nicht FAB).
- **Status:** Warten auf Freigabe durch Nutzer vor Umsetzung.

